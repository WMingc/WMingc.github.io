<!DOCTYPE html>
<html>  
  <head>  
        <meta charset="utf-8">  
        <title>敦煌壁画可视化-配色</title> 
        <link rel="stylesheet" type="text/css" href="css/style.css" /> 
        <style>
        .imgMatch{
        	position: relative;
        	width: 80%;
        	left:10%;
        	margin: 30px 0px;
        }
        .imgMatch img{
        	position: relative;
        	width: 100%;
        }
        .imgMatch2{
        	float: left;
        	position: relative;
        	width: 46%;
        	left:4%;
        	margin: 30px 0px;
        }
        .imgMatch2 img{
        	position: relative;
        	width: 100%;
        }
        .imgMatch3{
        	float: left;
        	position: relative;
        	width: 46%;
        	left:4%;
        	margin: 30px 0px;
        }
        .imgMatch3 img{
        	position: relative;
        	width: 100%;
        }
    </style>
  </head> 
  <body>  
		<script src="http://d3js.org/d3.v3.min.js"></script>
		<script src="http://vizjs.org/viz.v1.1.2.min.js"></script>
		<header class="mainheader">
				<h1>敦煌壁画可视化</h1>	
				<nav class="content">
					<a href="masaike.html">马赛克</a>
					<a href="cluster_index.html">聚类</a>
					<a>配色</a>
					<a href="enhance_index.html"">增强</a>
				</nav>
		</header>
		<div class = "imgMatch">
			<img src="img/match.png"/>
		</div>

		<script>
			
		var id =["暗龙胆紫",
		"龙葵紫","鸟梅紫","剑锋紫","鸽蓝","淡豆沙","丁香棕","淡土黄",
		"淡咖啡","淡赭","火泥棕","橡树棕","驼色","龟背黄","田螺绿","瓦松绿","虾壳青","藤萝紫","螺甸紫","烟红","满江红","月影白","冰山蓝"]; 

		var count=[
[0,0,0,1,0,1,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,1,1],
[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,1,1],
[0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,0,0,0,1,0,0,0,0],
[1,0,1,0,0,0,0,0,1,0,1,1,1,4,3,0,0,0,0,1,0,1,0],
[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0],
[0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],
[1,0,1,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,1,0,0,1,0],
[0,0,0,1,1,0,0,1,0,0,0,0,0,1,0,1,0,1,0,0,0,3,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0],
[1,0,0,1,0,0,1,1,0,0,0,0,0,1,0,1,2,0,0,0,0,2,0],
[1,1,2,1,0,0,0,0,0,0,0,0,0,0,1,0,2,0,0,1,0,0,0],
[1,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],
[1,0,0,4,0,1,0,0,1,0,1,0,1,0,1,0,1,0,0,2,0,1,0],
[0,0,0,3,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,1,0,0],
[0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,1,0],
[0,0,0,0,0,0,0,0,0,0,2,2,0,1,0,0,0,0,0,1,0,0,1],
[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1],
[0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0],
[0,1,0,1,0,0,0,0,0,1,0,1,0,2,0,0,1,0,0,0,0,2,0],
[0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,2,0,0,0,0],
[1,1,0,1,0,1,0,1,3,0,2,0,0,1,0,1,0,1,0,2,0,0,0],
[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0]

		];
		
		var chord_layout = d3.layout.chord()
			                 .padding(0.08)//弦之间的距离
			                 .sortSubgroups(d3.descending)//排序
			                 .matrix(count);

		var groups = chord_layout.groups();
		var chords = chord_layout.chords();
		console.log( groups );
		console.log( chords );
		
		var width  = 700;
		var height = 700;
		var innerRadius = width/2 * 0.75;//内圆半径
		var outerRadius = innerRadius * 1.1;//外圆半径
		
var fill =["#22202e", "#322f3b", "#1e131d", "#3e3841", "#1c2938", "#873d24","#71361d","#8c4b31","#945833","#be7e4a","#aa6a4c","#773d31","#66462a","#826b48","#5e665b","#6e8b74","#869d9d","#8076a3","#74759b","#894e54","#a7535a","#c0c4c3","#a4aca7"];

		var svg = d3.select("body").append("svg")
			.attr("width", width)
			.attr("height", height)
		    .append("g")
			.attr("transform", "translate(" + width/2 + "," + height/2 + ")");

		var outer_arc =  d3.svg.arc()
					 .innerRadius(innerRadius)
					 .outerRadius(outerRadius);
		
		svg.append("g").selectAll("path")
				.data(groups)
				.enter()
				.append("path")
				.style("fill", function(d) { return fill[d.index] })//
				.style("stroke", function(d) { return fill[d.index]; })
				.attr("d", outer_arc )
				.on("mouseover", fade(0.1))
        .on("mouseout", fade(0.8));
function fade(opacity) {
    return function(g, i) {
        svg.selectAll(".chord path")
            .filter(function(d) {
                return d.source.index != i && d.target.index != i; 
            })
            .transition()
            .style("opacity", opacity);// 不透明度
    };
}

			
		svg.append("g").selectAll("text")
				.data(groups)
				.enter()
				.append("text")
				.each( function(d,i) { 
					d.angle = (d.startAngle + d.endAngle) / 2; 
					d.name = id[i];
				})
				.attr("dy",".35em")
				.attr("font-size",13)
				.attr("transform", function(d){
					return "rotate(" + ( d.angle * 180 / Math.PI ) + ")" +
						   "translate(-25,"+ -1.0*(outerRadius+25) +")" ;
				})
				.text(function(d){
					return d.name;
				});
				
		var inner_chord =  d3.svg.chord()
						.radius(innerRadius);
		svg.append("g")
			.attr("class", "chord")
		    .selectAll("path")
			.data(chords)
		    .enter()
			.append("path")
			.attr("d", d3.svg.chord()
          .radius(innerRadius))
		    .style("fill", function(d) { 
            return fill[d.target.index];
        })
		    .style("stroke-width",0)
			.style("opacity", 0.6);// 不透明


var data=[];
count.forEach(function(r,i){ r.forEach(function(c,j){ if(r!=0&&c!=0)data.push([i,j,c])})});
var ch = viz.ch().data(data).padding(0.08)
	  	  .innerRadius(innerRadius)
	  	  .outerRadius(outerRadius)
	  	  .label(function(d){ return ""})
	  	  .startAngle(1.5*Math.PI)
	  	  .fill(function(d){ return fill[d];});

	  	  var svg2 = d3.select("body").append("svg").attr("height",height).attr("width",width);
	  	  svg2.append("g")

        .attr("transform", "translate("+width/2+","+height/2+")")
        .call(ch)
        .style("stroke-width",0)
        .style("opacity", 0.4)
        .on("mouseover", fade2(1))// 为路径添加鼠标事件
        .on("mouseout", fade2(0.4));

function fade2(opacity) {
    return function(g, i) {
        svg2.selectAll("g")   
            .transition()

            .style("opacity", opacity);// 不透明度
    };
}

d3.select(self.frameElement).style("height", height+"px").style("width", width+"px");


		</script>
		<div class = "imgMatch2">
			<img src="img/match1.png"/>
					</div>
			<div class = "imgMatch3">
			<img src="img/match2.png"/>

		</div>
    </body>  
</html>  